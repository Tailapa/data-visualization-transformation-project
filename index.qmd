---
title: "Project"
author: "Shashank"
subtitle: "Investigation into Chicago taxis"
echo: true
bibliography: references.bib
editor_options: 
  chunk_output_type: console
execute: 
  warning: false
---

### Note

1.  Depending on the purpose of the project, it may be advantageous to either show or hide all of your code in your rendered document. In this project, I've set echo = true so that the coding is visible.

2.  The `taxi` dataset is a pre-packaged R data set available in the **`modeldata`** package. This specific dataset contains information on a subset of taxi trips in **Chicago in 2022**, and is used for demonstrating or testing model-related R packages.Â 

## Packages

```{r}
#| label: Loading packages
#| message: false
#| warning: false
library(tidyverse)
library(tidymodels)
library(scales)

```

## Data Frame

```{r}
#| label: Loading dataset
library(modeldata)
```

### Summarize and glimpse of the dataset

```{r}
#| label: glimpse
glimpse(taxi)
```

The `taxi` dataframe has **`r nrow(taxi)`** rows and **`r ncol(taxi)`** columns.

## Is there there a relationship between the distance (in miles) someone travels in a taxi and if they tip or not?

```{r}
#| label: Examining if there is a relationship between distance travelled and tip
# Visualization
ggplot(taxi, aes(x = tip, y = distance, fill = tip)) +
  geom_boxplot() +
  labs(title = "Relationship between Trip Distance and Tipping",
       x = "Did the passenger tip?",
       y = "Distance (miles)") +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 16)
  )

# Summary Table
mean_median_distance_tipping <- taxi |>
  group_by(tip) |>
  summarize(mean_dist = mean(distance, na.rm = TRUE),
            median_dist = median(distance, na.rm = TRUE),
            n = n())
```

```{r}
#| label: Extracting mean and median Values
#| echo: false
# Assigning values
mean_distance_y <- mean_median_distance_tipping |> filter(tip == "yes") |> pull(mean_dist)
mean_distance_n <-mean_median_distance_tipping |> filter(tip == "no") |> pull(mean_dist)
med_dist_y <-mean_median_distance_tipping |> filter(tip == "yes") |> pull(median_dist)
med_dist_n <-mean_median_distance_tipping |> filter(tip == "no") |> pull(median_dist)
```

### Analysis of Distance vs. Tipping

There is a linear relationship between the distance traveled and whether a passenger tips for longer distances.

1.  Passengers who tipped traveled an average of **`r round(mean_distance_y, 2)` miles**, which is nearly **`r round(((mean_distance_y-mean_distance_n)/mean_distance_n)*100, 2)`% more** than those who did not tip (**`r round(mean_distance_n, 2)` miles**).

2.  Compared to the means, the medians are much closer (**`r med_dist_y` v/s `r med_dist_n`**) . This suggests that the "yes" group (those who tipped) mostly travelled long trips (outliers) that drives the average up.

3.  Therefore, tipping seems to be more common on longer trips.

## Do taxi passengers tend to tip more for the company Chicago Independents than the other companies?

```{r}
#| label: Analyse tips for each company
#| message: false

# 1. Calculate the overall city average rate (as a decimal)
overall_rate <- mean(taxi$tip == "yes")

# 2. Calculate the tipping rate per company for the labels
company_stats <- taxi |>
  group_by(company) |>
  summarize(
    total_rides = n(),
    yes_count = sum(tip == "yes"),
    tip_rate = yes_count / total_rides
  )

# 3. Create the Proportional Plot
ggplot(taxi, aes(y = company, fill = tip)) +
  # Create the proportional bars
  geom_bar(position = "fill") +
  # Add the tip rate labels onto each bar
  geom_text(
    data = company_stats,
    aes(y = company, x = 0.5, label = percent(tip_rate, accuracy = 0.1)),
    inherit.aes = FALSE,
    color = "white",
    fontface = "bold",
    size = 4
  ) +
  # Add the vertical line for the city average
  geom_vline(xintercept = overall_rate, linetype = "dashed", color = "white", size = 1) +
  # Annotate the line with the numerical value
  annotate(
    "text", 
    x = overall_rate, 
    y = 0.5, 
    label = paste0("City Average = ", percent(overall_rate, accuracy = 0.1)),
    color = "black", 
    vjust = -0.5, 
    hjust = -0.5,
    angle = 90,
    fontface = "bold"
  ) +
  # Clean up scales and labels
  scale_x_continuous(labels = percent) +
  scale_fill_manual(values = c("no" = "#E63946", "yes" = "#2A9D8F")) + # Clean vector-style colors
  labs(
    title = "Tipping Rate Comparison by Company",
    subtitle = "Is Chicago Independents outperforming the city average?",
    x = "Proportion of Trips",
    y = "Taxi Company",
    fill = "Tip Received"
  ) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 16)
  )
```

### Analysis of Tipping Rate Comparison

The data indicates that **Chicago Independents** has the highest tipping rate among all the taxi companies in the dataset.

1.  Tipping Rate of Chicago Independents is relatively higher at **`r percent(company_stats$tip_rate[company_stats$company == "Chicago Independents"], accuracy = 0.1)`**, compared to the overall tipping rate average of all companies, which is **`r percent(overall_rate, accuracy = 0.1)`**.

2.  When compared to other major comapnies, Chicago Independents outperforms **Flash Cab** (86.9%) by a wide margin of \~ 8 percentage points and edges out its closest competitor, **Sun Taxi** (93.9%).

3.  **However,** Chicago Independents has a smaller volume of total rides (781) compared to giants like Taxi Affiliation Services (1,694), their proportional success in securing tips is superior.

Yes, passengers tend to tip more for **Chicago Independents**. In a geometric breakdown of tipping proportions, the "Yes" segment for Chicago Independents occupies the largest relative area of the bar compared to all other categories. This suggests that despite being a smaller player in terms of ride volume, the company maintains a higher-than-average level of passenger tipping satisfaction.

## Your own question
