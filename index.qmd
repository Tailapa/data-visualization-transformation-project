---
title: "An Analysis of Chicago Taxi Trips"
subtitle: "Investigating the Geometry of Tipping Behavior"
author: "Shashank Venkatesh"
date: last-modified
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 2
    toc-location: left
    code-fold: false
    code-tools: true
    embed-resources: true
execute:
  echo: true
  warning: false
  message: false
bibliography: references.bib
editor_options: 
  chunk_output_type: console
---

### Note

1.  The `taxi` dataset is a pre-packaged R data set available in the **`modeldata`** package. This specific dataset contains information on a subset of taxi trips in **Chicago in 2022**, and is used for demonstrating or testing model-related R packages.Â 

## Packages

For this **Analysis of Chicago Taxi Trips,** we are using the following packages:

1.  `tidyverse`

2.  `tidymodels`

3.  `scales`

```{r}
#| label: Loading packages
#| message: false
#| warning: false
library(tidyverse)
library(tidymodels)
library(scales)
knitr::opts_chunk$set(fig.width = 9, fig.height = 5, fig.align = "center")
```

## Data Frame

The dataframe that we are using in this analysis is prepackaged in the R library `modeldata`

```{r}
#| label: Loading dataset
library(modeldata)
```

### Summarize and glimpse of the dataset

The `taxi` dataframe has **`r nrow(taxi)`** rows and **`r ncol(taxi)`** columns.

```{r}
#| label: glimpse
glimpse(taxi)
```

## Is there there a relationship between the distance (in miles) someone travels in a taxi and if they tip or not?

```{r}
#| label: Examining if there is a relationship between distance travelled and tip
# Visualization
ggplot(taxi, aes(x = tip, y = distance, fill = tip)) +
  geom_boxplot() +
  labs(title = "Relationship between Trip Distance and Tipping",
       x = "Did the passenger tip?",
       y = "Distance (miles)") +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 16)
  )

# Summary Table
mean_median_distance_tipping <- taxi |>
  group_by(tip) |>
  summarize(mean_dist = mean(distance, na.rm = TRUE),
            median_dist = median(distance, na.rm = TRUE),
            n = n())
```

```{r}
#| label: Extracting mean and median Values
#| echo: false
# Assigning values
mean_distance_y <- mean_median_distance_tipping |> filter(tip == "yes") |> pull(mean_dist)
mean_distance_n <-mean_median_distance_tipping |> filter(tip == "no") |> pull(mean_dist)
med_dist_y <-mean_median_distance_tipping |> filter(tip == "yes") |> pull(median_dist)
med_dist_n <-mean_median_distance_tipping |> filter(tip == "no") |> pull(median_dist)
```

### Analysis of Distance vs. Tipping

There is a linear relationship between the distance traveled and whether a passenger tips for longer distances.

1.  Passengers who tipped traveled an average of **`r round(mean_distance_y, 2)` miles**, which is nearly **`r round(((mean_distance_y-mean_distance_n)/mean_distance_n)*100, 2)`% more** than those who did not tip (**`r round(mean_distance_n, 2)` miles**).

2.  Compared to the means, the medians are much closer (**`r med_dist_y` v/s `r med_dist_n`**) . This suggests that the "yes" group (those who tipped) mostly travelled long trips (outliers) that drives the average up.

3.  Therefore, tipping seems to be more common on longer trips.

## Do taxi passengers tend to tip more for the company Chicago Independents than the other companies?

```{r}
#| label: Analysing tipping stats of each company
#| message: false

# 1. Calculating the overall city average rate (as a decimal)
overall_rate <- mean(taxi$tip == "yes")

# 2. Calculating the tipping rate per company for the labels
company_stats <- taxi |>
  group_by(company) |>
  summarize(
    total_rides = n(),
    yes_count = sum(tip == "yes"),
    tip_rate = yes_count / total_rides
  )

company_stats <- company_stats |> 
  arrange(desc(tip_rate))

# 3. Creating the Plot
ggplot(taxi, aes(y = company, fill = tip)) +
  # Creating the graph bar
  geom_bar(position = "fill") +
  # Adding the tip rate labels onto each bar
  geom_text(
    data = company_stats,
    aes(y = company, x = 0.5, label = percent(tip_rate, accuracy = 0.1)),
    inherit.aes = FALSE,
    color = "white",
    fontface = "bold",
    size = 4
  ) +
  # Adding the vertical line for the overall city average
  geom_vline(xintercept = overall_rate, linetype = "dashed", color = "white", size = 1) +
  # Annotating the line with the numerical value
  annotate(
    "text", 
    x = overall_rate, 
    y = 0.5, 
    label = paste0("City Average = ", percent(overall_rate, accuracy = 0.1)),
    color = "black", 
    vjust = -0.5, 
    hjust = -0.5,
    angle = 90,
    fontface = "bold"
  ) +
  # Cleaning up scales and labels
  scale_x_continuous(labels = percent) +
  scale_fill_manual(values = c("no" = "#E63946", "yes" = "#2A9D8F")) + # Clean vector-style colors
  labs(
    title = "Tipping Rate Comparison by Company",
    subtitle = "Is Chicago Independents outperforming the city average?",
    x = "Proportion of Trips",
    y = "Taxi Company",
    fill = "Tip Received"
  ) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(),
    plot.title = element_text(face = "bold", size = 16)
  )

```

```{r}
#| label: Sorting company stats by number of rides
#| echo: false
company_stats_by_rides <- company_stats |> 
  arrange(desc(total_rides))
```

### Analysis of Tipping Rate Comparison

The data indicates that **Chicago Independents** has the highest tipping rate among all the taxi companies in the dataset.

1.  Tipping Rate of **`r company_stats$company[1]`** is relatively higher at **`r percent(company_stats$tip_rate[company_stats$company == "Chicago Independents"], accuracy = 0.1)`**, compared to the overall tipping rate average of all companies, which is **`r percent(overall_rate, accuracy = 0.1)`**.

2.  When compared to other major comapnies, **`r company_stats$company[1]`** outperforms **`r company_stats$company[nrow(company_stats)]`** by a wide margin of **`r percent(company_stats$tip_rate[1] - company_stats$tip_rate[nrow(company_stats)], accuracy = 0.1)`** percentage points and edges out its closest competitor, **`r company_stats$company[2]`** by **`r percent(company_stats$tip_rate[1] - company_stats$tip_rate[2], accuracy = 0.1)`** percentage points.

3.  However, **`r company_stats$company[1]`** has a smaller volume of total rides `r company_stats$total_rides[1]` (**`r percent(company_stats$total_rides[1]/sum(company_stats$total_rides), accuracy = 0.1)`**), compared to giants like **`r company_stats_by_rides$company[2]`**, whose proportion of ride share is, **`r percent(company_stats_by_rides$total_rides[2]/sum(company_stats$total_rides), accuracy = 0.1)`**. Nevertheless, **`r company_stats$company[1]`'** proportional success in securing tips is superior.

Therefore, despite being a smaller player in terms of ride volume, the **`r company_stats$company[1]`** maintain an above average rate of passenger tipping .

## Are passengers more likely to tip during late-night hours compared to the rest of the day?

```{r}
#| label: Analysis of tipping during late-night hours
#| message: false
#| warning: false

# 1. Calculating tip rate by hour
hourly_tips <- taxi |>
  group_by(hour) |>
  summarize(
    total_rides = n(),
    tip_rate = sum(tip == "yes") / total_rides
  )

# 2. Plotting the Geometric Line Plot
ggplot(hourly_tips, aes(x = hour, y = tip_rate)) +
  geom_area(fill = "#2A9D8F", alpha = 0.2) + 
  # Adding geometric line
  geom_line(color = "#2A9D8F", size = 1) +
  # Adding Points for each hour
  geom_point(color = "#2A9D8F", size = 2) +
  # Adding a baseline - city average line
  geom_hline(yintercept = overall_rate, linetype = "dashed", color = "black") +
  annotate("text", x = 10, y = overall_rate + 0.01, 
           label = paste0(
             "Average Tipping probability = ", 
             percent(overall_rate, accuracy = 0.1)), 
           color = "black", fontface = "bold") +
  scale_y_continuous(labels = percent, limits = c(0.9, 1)) +
  scale_x_continuous(breaks = 0:23) +
  labs(
    title = "Does the Time of Day Influence Tipping?",
    subtitle = "Tipping rates plotted across a 24-hour cycle",
    x = "Hour of Day (0 = Midnight)",
    y = "Tipping Probability"
  ) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank(), 
    plot.title = element_text(face = "bold", size = 16)
    )
```

The temporal data reveals the hourly fluctuation in tipping behavior in Chicago taxis throughout the day, showing distinct peaks during late-night and early-morning hours.

1.  **The Happy Hours:** Interestingly, the highest tipping rates occur in the very early morning. Both **2:00 AM** and **4:00 AM** show a tipping rate of **100%** (though it should be noted these hours have lower ride volumes of **`r hourly_tips$total_rides[hourly_tips$hour == 2]` and `r hourly_tips$total_rides[hourly_tips$hour == 4]`** respectively).

2.  **Dip during noon:** The tipping rate fluctuates during high ride-volume periods. For instance, at **12:00 PM** (noon), when ride volume is high (**`r hourly_tips$total_rides[hourly_tips$hour == 12]`** rides), the tip rate dips to **`r percent(hourly_tips$tip_rate[hourly_tips$hour == 12], accuracy = 0.1)`**.

3.  **Evening Surge:** Towards the end of the day, the tipping rate tends to increase. From **5:00 PM (17:00)** to **8:00 PM (20:00)**, the tipping rate rises from **`r percent(hourly_tips$tip_rate[hourly_tips$hour == 17], accuracy = 0.1)`** to **`r percent(hourly_tips$tip_rate[hourly_tips$hour == 20], accuracy = 0.1)`**.

Therefore, time of the ride seems to influence tipping. Passengers during the late evening and early morning hours tend to tip at rates higher than Chicago's average tipping probability of **`r percent(overall_rate, accuracy = 0.1)`**. Further, the "perfect" scores at 2:00 AM and 4:00 AM are more likely to be skewed by low sample sizes. However, the general expected trend is for the evening and mid-night passengers to be more consistent tippers than their mid-day counterparts.

## Conclusion

The investigation into the Chicago taxi market illustrates that tipping behavior is not random and is rather moulded by the interplay of 3 factors - **distance, passenger, and time.**

There is a strong shift in tipping probability as mileage increases. The significantly higher mean distance for tippers (**6.37 miles**) suggests that long journeys are the primary drivers of consistent tipping behavior. Among the taxi-enterprises, **Chicago Independents**, despite having a smaller market share of only **7.8%**, maintain a dominant tipping rate of **94.9%**, thus outperforming other industry players and exceeding the average city tipping rate of 92.1%. Tipping behavior also fluctuates over a 24-hour period. The tipping probability peaks during the late-night and early-morning hours, consistently exceeding the **92.1%** city average towards the end of the day.

Overall, one can expect a typical Chicago taxi trip to be short and local. However, we estimate the most ideal tipping scenario by the maximum overlap of our three variables, which **on average, is a [long-distance trip during late nights, especially when the service provider is Chicago Independents.]{.underline}**
